# vim:syntax=python

import lit

config.name = 'Pegmatite'
config.suffixes = [ '.cc', '.cpp' ]
config.test_format = lit.formats.ShTest()

params = lit_config.params

srcroot = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
buildroot = params.get('buildroot', os.path.join(srcroot, 'build'))

config.environment['LD_LIBRARY_PATH'] = buildroot

cflags = '-std=c++14 -I %s' % srcroot
if params.get('rtti', 'ON') == 'ON':
    cflags += ' -D USE_RTTI'

ldflags = '-l pegmatite -L %s' % buildroot

config.substitutions += [
    ('%cxx', 'c++ %s %s' % (cflags, ldflags)),
    ('%FileCheck', params.get('filecheck', 'FileCheck')),
]

if 'outputdir' in params:
    config.test_exec_root = params['outputdir']
else:
    import tempfile
    config.test_exec_root = tempfile.mkdtemp(prefix = 'pegmatite-test')
